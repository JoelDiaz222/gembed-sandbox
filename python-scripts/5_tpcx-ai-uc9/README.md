# Benchmark 5: TPCx-AI Use Case 9 - Facial Recognition (Img-to-Img)

## Purpose

This benchmark evaluates and compares the performance of a "Unified" database approach against specialized Vector Databases for a multi-modal workload, modeled after TPCx-AI Use Case 9 (Facial Recognition/Image Retrieval).

The workload consists of:
1.  **Ingestion Phase**: Storing and indexing images. The system must generate embeddings (vectors) from raw image data and index them for search.
2.  **Serving Phase**: Processing new "query" images by generating their embeddings and performing a Nearest Neighbor search against the ingested dataset.

## Methods Tested

| Method | Component | Embedding Location | Search Engine | Description |
|--------|-----------|--------------------|---------------|-------------|
| **PG Unified** | PostgreSQL | In-DB (`pg_gembed`) | `pgvector` (HNSW) | Images stored as `BYTEA` in DB. Embeddings generated internally via SQL function calls. |
| **Chroma** | ChromaDB | Application (Python) | Chroma (HNSW) | Images loaded in Python, embeddings generated by `embed-anything`, stored in Chroma. |
| **Qdrant** | Qdrant | Application (Python) | Qdrant (HNSW) | Images loaded in Python, embeddings generated by `embed-anything`, stored in Qdrant container. |

## Key Features

-   **Realistic Multi-modal Workload**: Handles binary image data, simulating a facial recognition pipeline.
-   **Limited Dataset Handling**: Capable of benchmarking large logical sizes (e.g., 2048 images) even if the physical dataset on disk is small (e.g., 100 images) by recycling/looping over available files.
-   **Resource Monitoring**: Tracks CPU and Memory usage for Python, PostgreSQL, and Docker (Qdrant).

## Prerequisites

-   **PostgreSQL**: With `vector` and `pg_gembed` extensions.
-   **Qdrant**: Docker container running on port 6333.
-   **Data**: Images in `data/CUSTOMER_IMAGES`.

## Running the Benchmark

```bash
python 5_tpcx-ai-uc9/benchmark.py
```

## Output

Results are saved in `output/ingestion` and `output/serving` with CSVs and plots.
